doctype html
html(lang="es")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    title Dashboard | Clickwave
    link(href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap", rel="stylesheet")
    link(rel="stylesheet", href="/css/dashboard.css")
    script(src="/js/dashboard.js" defer)
  body.dashboard-layout
    // HEADER SUPERIOR
    header.header
      .header-left
        h1.logo Clickwave
      .header-center
        input#globalSearch(type="text", placeholder="Buscar proyectos, tareas o empleados...")
      .header-right
        span.user-name #{user ? user.nombre : 'Empleado'}
        a(href="/auth/logout").logout-btn Cerrar sesiÃ³n

    // CONTENIDO PRINCIPAL
    main.main-content
      h2 Mi Dashboard

      .dashboard-grid
        // PROYECTOS (izq)
        .dash-card#projectsCard
          .dash-card-header
            h3 Proyectos
            if user && user.rol === 'administrador'
              a.btn-view-all(href="/projects/new") â• Nuevo
          .dash-card-body
            ul.project-list#projectList
              if proyectos && proyectos.length > 0
                each proyecto in proyectos
                  li.project-item(data-id=proyecto._id data-nombre=proyecto.nombre)
                    .left
                      strong.project-name= proyecto.nombre
                      if proyecto.descripcion
                        div.project-desc= proyecto.descripcion
                      else
                        div.project-desc.text-muted â€” sin descripciÃ³n
                    .right
                      // status inline select only for admin (or show badge for employees)
                      if user && user.rol === 'administrador'
                        select.project-status-admin(data-id=proyecto._id onchange="updateProjectStatus(this)")
                          option(value="pendiente", selected=proyecto.estado==='pendiente') Pendiente
                          option(value="en curso", selected=proyecto.estado==='en curso') En curso
                          option(value="finalizado", selected=proyecto.estado==='finalizado') Finalizado
                        a.btn-edit(href=`/projects/${proyecto._id}/edit`) âœï¸
                        button.btn-delete(type="button", onclick=`deleteProject('${proyecto._id}')`) ğŸ—‘ï¸
                      else
                        span.badge(class=`item-status ${proyecto.estado}`)= proyecto.estado
              else
                li No hay proyectos asignados.

        // TAREAS (der)
        .dash-card#tasksCard
          .dash-card-header
            h3 Tareas del Proyecto
            if user && user.rol === 'administrador'
              a.btn-view-all(href="/tasks/new") â• Nueva
          .dash-card-body
            p#selectedProjectLabel SeleccionÃ¡ un proyecto a la izquierda
            ul.task-list#taskList
              // populated by JS

      // BLOQUE ADMIN: Empleados + mÃ©tricas
      if user && user.rol === 'administrador'
        .dash-card.admin-section
          .dash-card-header
            h3 GestiÃ³n de Empleados
            a.btn-view-all(href="/admin/empleados/new") â• Nuevo Empleado
          .dash-card-body
            ul.employee-list#employeeList
              if empleados && empleados.length > 0
                each e in empleados
                  li.employee-item
                    span.emp-name= `${e.nombre} ${e.apellido}`
                    span.emp-role= e.rol
                    .emp-actions
                      a(href=`/admin/empleados/${e._id}/edit`) âœï¸
                      button(type="button", onclick=`deleteEmployee('${e._id}')`) ğŸ—‘ï¸
              else
                li No hay empleados.

        .dash-card.metrics
          .dash-card-header
            h3 MÃ©tricas (prÃ³ximamente)
          .dash-card-body
            p.text-muted AquÃ­ se mostrarÃ¡n mÃ©tricas globales para administradores.
