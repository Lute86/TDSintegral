doctype html
html(lang="es")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    title Dashboard | Clickwave
    link(
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap",
      rel="stylesheet"
    )
    link(rel="stylesheet", href="/css/dashboard.css")
    script(src="/js/dashboard.js" defer)


  body.dashboard-layout
    // ===== HEADER SUPERIOR =====
    header.header
      .header-left
        h1.logo Clickwave
      .header-center
        input#globalSearch(type="text", placeholder="Buscar proyectos, tareas o empleados...")
        button.btn-view-white(type="button" data-open-modal data-url="/" data-title="Facturacion") Facturacion
      .header-right
        span.user-name #{user ? user.nombre : 'Empleado'}
        a.logout-btn(href="/auth/logout") Cerrar sesi√≥n

    // ===== CONTENIDO PRINCIPAL =====
    main.main-content
      h2 Mi Panel

        .dashboard-grid
          // PROYECTOS
          .dash-card#projectsCard
            .dash-card-header
              h3 Proyectos
              if user && user.rol === 'administrador'
                button.btn-view-all(type="button" data-open-modal data-url="/project/view/new" data-title="Nuevo Proyecto") ‚ûï Nuevo Proyecto
            .dash-card-body
              ul.project-list#projectList
                if proyectos && proyectos.length
                  each proyecto in proyectos
                    li.project-item(data-id=proyecto._id)
                      .left
                        strong.project-name= proyecto.nombre
                      .right
                        if user && user.rol === 'administrador'
                          .emp-actions
                            button.btn-edit(type="button" data-open-modal data-url="/project/view/edit/${proyecto._id}" data-title="Editar Proyecto") ‚úèÔ∏è
                            button.btn-delete( type="button" data-delete-url=`/project/view/delete/${proyecto._id}` data-confirm=`¬øEliminar proyecto ${proyecto.nombre}?`) üóëÔ∏è
                        else
                          span.badge.item-status(class=proyecto.estado.replace(/\s+/g,'-'))= proyecto.estado
                else
                  li No hay proyectos asignados.

          // TAREAS
          .dash-card#tasksCard
            .dash-card-header
              h3 Tareas del Proyecto
              if user && user.rol === 'administrador'
                button.btn-view-all(type="button" data-open-modal data-url="/task/view/new" data-title="Nueva Tarea") ‚ûï Nueva
            .dash-card-body
              if tareas && tareas.length
                ul.task-list#taskList
                  each t in tareas
                    li.task-item(data-id=t._id)
                      .left
                        strong.task-name= t.nombre
                        p.task-desc= t.descripcion || 'Sin descripci√≥n'
                      .right
                        if user && user.rol === 'administrador'
                          a.btn-edit(href=`/task/view/edit/${t._id}`) ‚úèÔ∏è
                          button.btn-delete(type="button" data-delete-url=`/task/view/${t._id}` data-confirm=`¬øEliminar la tarea ${t.nombre}?`) üóëÔ∏è
                        else
                          form(action=`/task/${t._id}?_method=PUT` method="POST")
                            select(name="estado", onchange="this.form.submit()")
                              option(value="pendiente" selected=t.estado==='pendiente') Pendiente
                              option(value="en proceso" selected=t.estado==='en proceso') En proceso
                              option(value="finalizada" selected=t.estado==='finalizada') Finalizada
              else
                p No hay tareas disponibles.

        // ADMIN (solo admin)
        if user && user.rol === 'administrador'
          .dash-card.admin-section
            .dash-card-header
              h3 Gesti√≥n de Empleados
              button.btn-view-all(
                type="button"
                data-open-modal
                data-url="/employee/new"
                data-title="Nuevo Empleado"
              ) ‚ûï Nuevo Empleado

            .dash-card-body
              #employeeTableBody
                ul.employee-list
                  if empleados && empleados.length
                    each e in empleados
                      li.employee-item
                        span.emp-name #{e.nombre} #{e.apellido}
                        span.emp-role #{e.rol}
                        .emp-actions
                          button.btn-edit(
                            type="button"
                            data-open-modal
                            data-url=`/employee/edit/${e._id}`
                            data-title="Editar Empleado"
                          ) ‚úèÔ∏è
                          button.btn-delete(
                            type="button"
                            data-delete-url=`/employee/delete/${e._id}`
                            data-confirm=`¬øEliminar ${e.nombre} ${e.apellido}?`
                          ) üóëÔ∏è
                  else
                    li No hay empleados registrados


            .dash-card.metrics
              .dash-card-header
                h3 M√©tricas (pr√≥ximamente)
              .dash-card-body
                p.text-muted Aqu√≠ se mostrar√°n m√©tricas globales para administradores.
  
  // ===== MODAL GLOBAL =====
  div#modalOverlay.modal-overlay
  div#dashboardModal.login-modal
    span.modal-close(onclick="closeModal()") &times;
    iframe#modal-frame.modal-frame