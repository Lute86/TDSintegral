doctype html
html(lang="es")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    title Dashboard | Clickwave
    link(href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap", rel="stylesheet")
    link(rel="stylesheet", href="/css/dashboard.css")
    script(src="/js/dashboard.js" defer)
  body.dashboard-layout
    // HEADER SUPERIOR
    header.header
      .header-left
        h1.logo Clickwave
      .header-center
        input#globalSearch(type="text", placeholder="Buscar proyectos, tareas o empleados...")
      .header-right
        span.user-name #{user ? user.nombre : 'Empleado'}
        a(href="/auth/logout").logout-btn Cerrar sesiÃ³n

    // CONTENIDO PRINCIPAL
    main.main-content
      h2 Mi Dashboard

      .dashboard-grid
        // ================== PROYECTOS (izquierda)
        .dash-card#projectsCard
          .dash-card-header
            h3 Proyectos
            if user && user.rol === 'administrador'
              a.btn-view-all(href="/projects/new") â• Nuevo
          .dash-card-body
            ul.project-list#projectList
              if proyectos && proyectos.length > 0
                each proyecto in proyectos
                  li.project-item
                    .left
                      strong.project-name= proyecto.nombre
                    .right
                      if user && user.rol === 'administrador'
                        form(action=`/projects/${proyecto._id}?_method=PUT`, method="POST", class="inline-form")
                          select(name="estado", onchange="this.form.submit()")
                            option(value="pendiente", selected=proyecto.estado==='pendiente') Pendiente
                            option(value="en curso", selected=proyecto.estado==='en curso') En curso
                            option(value="finalizado", selected=proyecto.estado==='finalizado') Finalizado
                        a.btn-edit(href=`/projects/${proyecto._id}/edit`) âœï¸
                        button.btn-delete(type="button", onclick=`deleteProject('${proyecto._id}')`) ğŸ—‘ï¸
                      else
                        span.badge(class=`item-status ${proyecto.estado}`)= proyecto.estado
              else
                li No hay proyectos asignados.

        // ================== TAREAS (derecha)
        .dash-card#tasksCard
          .dash-card-header
            h3 Tareas del Proyecto
            if user && user.rol === 'administrador'
              a.btn-view-all(href="/tasks/new") â• Nueva
          .dash-card-body
            if tareas && tareas.length > 0
              ul.task-list#taskList
                each t in tareas
                  li.task-item
                    .left
                      strong.task-name= t.nombre
                      p.task-desc= t.descripcion || 'Sin descripciÃ³n'
                      small Proyecto: #{t.project ? t.project.nombre : 'N/A'}
                    .right
                      if user && user.rol === 'administrador'
                        a.btn-edit(href=`/tasks/${t._id}/edit`) âœï¸
                        button.btn-delete(type="button", onclick=`deleteTask('${t._id}')`) ğŸ—‘ï¸
                      else
                        form(action=`/tasks/${t._id}?_method=PUT`, method="POST")
                          select(name="estado", onchange="this.form.submit()")
                            option(value="pendiente", selected=t.estado==='pendiente') Pendiente
                            option(value="en proceso", selected=t.estado==='en proceso') En proceso
                            option(value="finalizada", selected=t.estado==='finalizada') Finalizada
            else
              p No hay tareas disponibles.

      // ================== ADMINISTRACIÃ“N (solo admin)
      if user && user.rol === 'administrador'
        .dash-card.admin-section
          .dash-card-header
            h3 GestiÃ³n de Empleados
            a.btn-view-all(href="/admin/empleados/new") â• Nuevo Empleado
          .dash-card-body
            ul.employee-list#employeeList
              if empleados && empleados.length > 0
                each e in empleados
                  li.employee-item
                    span.emp-name= `${e.nombre} ${e.apellido}`
                    span.emp-role= e.rol
                    .emp-actions
                      a(href=`/admin/empleados/${e._id}/edit`) âœï¸
                      button(type="button", onclick=`deleteEmployee('${e._id}')`) ğŸ—‘ï¸
              else
                li No hay empleados registrados.

        .dash-card.metrics
          .dash-card-header
            h3 MÃ©tricas (prÃ³ximamente)
          .dash-card-body
            p.text-muted AquÃ­ se mostrarÃ¡n mÃ©tricas globales para administradores.

    // ================== SCRIPTS
    script.
      async function deleteProject(id) {
        if (!confirm('Â¿Eliminar proyecto y sus tareas asociadas?')) return;
        await fetch(`/projects/${id}`, { method: 'DELETE' });
        location.reload();
      }

      async function deleteTask(id) {
        if (!confirm('Â¿Eliminar esta tarea?')) return;
        await fetch(`/tasks/${id}`, { method: 'DELETE' });
        location.reload();
      }

      async function deleteEmployee(id) {
        if (!confirm('Â¿Eliminar este empleado?')) return;
        await fetch(`/employee/${id}`, { method: 'DELETE' });
        location.reload();
      }
