.dash-card.consultas-section(data-search="cliente")
  .dash-card-header
    h3 ğŸ“© Consultas de Clientes
    if consultas && consultas.length > 0
      - const nuevas = consultas.filter((c) => c.estado === "nuevo").length;
      if nuevas > 0
        span.consultas-badge= nuevas
  .dash-card-body
    if consultas && consultas.length > 0
      ul.consultas-list
        each c in consultas
          li.consulta-item(class=c.estado, data-text=`${c.nombre} ${c.apellido} ${c.email} ${c.servicio} ${c.estado} ${c.consulta || ""}`)
            .consulta-main
              .consulta-header
                strong.consulta-nombre= c.nombre + " " + c.apellido
                span.consulta-badge(class="badge-" + c.estado)= c.estado
              .consulta-details
                small.consulta-email ğŸ“§ #{ c.email }
                small.consulta-servicio ğŸ¯ #{ c.servicio }
                if c.consulta
                  p.consulta-mensaje= c.consulta
            .consulta-actions
              if c.estado === "nuevo"
                form(
                  action="/clientes/" + c._id + "/estado",
                  method="POST",
                  style="display: inline"
                )
                  input(type="hidden", name="estado", value="contactado")
                  button.btn-contactar(type="submit") âœ“
              if c.estado === "contactado"
                form(
                  action="/clientes/" + c._id + "/estado",
                  method="POST",
                  style="display: inline"
                )
                  input(type="hidden", name="estado", value="cerrado")
                  button.btn-cerrar(type="submit") âœ…
              button.btn-add(
                type="button",
                onclick=`addClientFromConsulta(
                  '${c._id}',
                  '${c.nombre}',
                  '${c.apellido}',
                  '${c.email}',
                  '${(c.consulta || "").replace(/'/g,"\\'")}'
                )`
              ) +  
              button.btn-delete(
                    type="button",
                    onclick=`if(confirm('Â¿Eliminar tarea?')) deleteClient('${c._id}')`
                  ) ğŸ—‘ï¸
    else
      p.text-muted No hay consultas registradas.
